import{J as n}from"./index-Dw23voMM.js";import{writeObjectToJsonAttachment as t}from"./device-CkMfJqCF.js";async function e(t){if(!t||"object"!=typeof t||!t.id)throw new Error("Invalid or missing path");if(e=t.id,/^https?:\/\//i.test(e))try{const e=await fetch(t.id);if(!e.ok)throw new Error(`Failed to fetch URL ${t.id}: ${e.statusText}`);const o=await e.text(),r=n.parse(o),i=new URL(t.id).pathname.split("/").pop()||"url_data.json";return{content:r,path:{...t,fileName:i}}}catch(o){throw{code:404,error:`Failed to read or parse URL ${t.id}: ${o.message}`}}var e}async function o(n,e){if(!n||"object"!=typeof n)throw new Error("Invalid or missing data object");if(!e||"object"!=typeof e||!e.fileName)throw new Error("Invalid or missing path");return t(n,{...e,mode:"D"})}function r(){return!0}const i=async()=>{const n=await async function(){const n=document.createElement("div");n.id="overlay";const t=document.createElement("iframe");t.id="pickerFrame",n.appendChild(t),document.body.appendChild(n),n.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.5);\n        z-index: 999;\n        opacity: 0;\n        transition: opacity 0.3s ease;\n    ",t.style.cssText="\n        width: 500px;\n        height: 200px;\n        border: none;\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%) scale(0.9);\n        background: white;\n        border: 1px solid #ccc;\n        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n        opacity: 0;\n        transition: all 0.3s ease;\n        border-radius: 8px;\n    ",n.offsetWidth,t.offsetWidth,n.style.opacity="1",t.style.opacity="1",t.style.transform="translate(-50%, -50%) scale(1)";const e=Date.now().toString(36)+Math.random().toString(36).substr(2);n.addEventListener("click",o=>{o.target===n&&t.contentWindow.postMessage({type:"cancel",instanceId:e,error:"Clicked outside"},"*")});const o=t.contentDocument||t.contentWindow.document;return o.open(),o.write(`\n        <!DOCTYPE html>\n        <html>\n        <head>\n            <meta charset="UTF-8">\n            <style>\n                body {\n                    margin: 0;\n                    padding: 0;\n                    font-family: Arial, sans-serif;\n                    height: 100%;\n                }\n                .file-picker {\n                    width: 100%;\n                    height: 100%;\n                }\n                .container {\n                    padding: 20px;\n                    box-sizing: border-box;\n                    display: flex;\n                    flex-direction: column;\n                    flex-grow: 1;\n                    position: absolute;\n                    inset: 0;\n                }\n                .close-btn {\n                    position: absolute;\n                    top: 10px;\n                    right: 10px;\n                    font-size: 20px;\n                    border: none;\n                    background: none;\n                    cursor: pointer;\n                    color: #666;\n                }\n                .close-btn:hover {\n                    color: #333;\n                }\n                .url {\n                    display: flex;\n                    align-items: center;\n                    gap: 8px;\n                }\n                #urlInput {\n                    padding: 8px;\n                    flex-grow: 1;\n                    border: 1px solid #ddd;\n                    border-radius: 4px;\n                }\n                button {\n                    padding: 8px 16px;\n                    background-color: #f0f0f0;\n                    border: 1px solid #ddd;\n                    border-radius: 4px;\n                    cursor: pointer;\n                    transition: all 0.2s;\n                }\n                button:hover {\n                    background-color: #e0e0e0;\n                }\n    \n                .button-container {\n                    display: flex;\n                    justify-content: flex-end;\n                    gap: 10px;\n                }\n                .button-container button:first-child {\n                    background-color: #4a90e2;\n                    color: white;\n                }\n                .button-container button:first-child:hover {\n                    background-color: #3a7bc8;\n                }\n                .confirm-btn {\n                    padding: 10px 16px;\n                    background-color: #4a90e2;\n                    color: white;\n                    border: none;\n                    border-radius: 6px;\n                    cursor: pointer;\n                    font-weight: 500;\n                    font-size: 14px;\n                    transition: all 0.2s;\n                    white-space: nowrap;\n                }\n\n            </style>\n        </head>\n        <body>\n            <div class="file-picker">\n                <div class="container">\n                    <button class="close-btn" onclick="closeDialog()">Ã—</button>\n                    <h3>Input a .treegridio URL</h3>\n                    <div class="url">\n                        <input type="text" id="urlInput" placeholder="input .treegridio url..." >\n                        <button class="confirm-btn" onclick="confirmUrl()">Load URL</button>\n                    </div>\n                    \n                </div>\n            </div>\n            <script>\n \n                const instanceId = "${e}";\n\n                function cancel() {\n                    window.parent.postMessage({\n                        type: 'cancel',\n                        instanceId: instanceId,\n                        error: 'Selection cancelled'\n                    }, '*');\n                }\n\n                function closeDialog() {\n                    window.parent.postMessage({\n                        type: 'cancel',\n                        instanceId: instanceId,\n                        error: 'Dialog closed'\n                    }, '*');\n                }\n\n                document.addEventListener('keydown', function(e) {\n                    if (e.key === 'Escape') {\n                        closeDialog();\n                    }else if(e.key==='Enter'){\n                        confirmUrl();\n                    }\n                });\n\n                const sample = 'https://perfecttodo.com/gdgaoxiao.treegridio';\n                function confirmUrl() {\n                    const urlInput = document.getElementById('urlInput');\n                    const selectedItem = urlInput.value.trim();\n                    \n                    if (!selectedItem) {\n                        urlInput.focus();\n                        urlInput.setAttribute('placeholder', 'Please enter a valid URL');\n                        urlInput.classList.add('error');\n                        setTimeout(() => {\n                            urlInput.classList.remove('error');\n                            urlInput.setAttribute('placeholder', sample);\n                        }, 2000);\n                        return;\n                    }\n                    \n                    // Basic URL validation\n                    if (!selectedItem.startsWith('http://') && !selectedItem.startsWith('https://')) {\n                        urlInput.value = '';\n                        urlInput.setAttribute('placeholder', 'URL must start with http:// or https://');\n                        urlInput.classList.add('error');\n                        setTimeout(() => {\n                            urlInput.classList.remove('error');\n                            urlInput.setAttribute('placeholder', sample);\n                        }, 2000);\n                        return;\n                    }\n                    \n                    window.parent.postMessage({\n                        type: 'select',\n                        instanceId: instanceId,\n                        value: selectedItem\n                    }, '*');\n                }\n\n                document.getElementById('urlInput').focus();\n            <\/script>\n        </body>\n        </html>\n    `),o.close(),new Promise((t,o)=>{const r=async i=>{if(i.data.instanceId!==e)return;const s=()=>{window.removeEventListener("message",r),n.style.opacity="0",setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},300)};if("select"===i.data.type){s();try{t({filename:i.data.value})}catch(a){o(a)}}else"cancel"===i.data.type&&(s(),o(new Error(i.data.error)))};window.addEventListener("message",r)})}();return{mode:"U",file:{...n,id:n.filename}}},s="Browser";export{r as authorize,i as pickFile,e as readJsonAttachment,s as type,o as writeObjectToJsonAttachment};
